<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CarRent â€” Notifications</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white">
  <div id="nav-root"></div>
  <main class="pt-20">
    <div class="container-max mx-auto px-4 py-8">
      <div class="flex items-center justify-between mb-8">
        <h1 class="text-3xl font-bold">Notifications</h1>
        <button id="mark-all" class="btn btn-primary">Mark All as Read</button>
      </div>
      <div id="notifications-list"></div>
    </div>
  </main>
  <script src="/js/api.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/ui.js"></script>
  <script src="/js/notifications.js"></script>
  <script>
    window.UI.mountNavbar();
    function renderNotifications(items) { var list = document.getElementById("notifications-list"); if (!list) return; list.innerHTML = ""; if (!items || !items.length) { list.innerHTML = '<p class="text-slate-600 dark:text-slate-400">No notifications.</p>'; return; } for (var i = 0; i < items.length; i++) { var n = items[i]; var node = document.createElement("div"); node.className = "glass card p-4 rounded-xl mb-3 flex justify-between items-start animate-fade-in"; var left = document.createElement("div"); var title = document.createElement("div"); title.className = "font-bold text-base"; title.innerText = n.title || "Notification"; var msg = document.createElement("div"); msg.className = "text-sm text-slate-600 dark:text-slate-400 mt-1"; msg.innerText = n.message || ""; left.appendChild(title); left.appendChild(msg); var right = document.createElement("div"); right.className = "text-right"; var time = document.createElement("div"); time.className = "text-xs text-slate-500 dark:text-slate-400 mb-2"; time.innerText = n.createdAt ? new Date(n.createdAt).toLocaleString() : ""; var btn = document.createElement("button"); btn.className = "btn btn-primary small"; btn.innerText = n.read ? "Read" : "Mark Read"; (function (id) { btn.addEventListener("click", function () { window.Notifications.markRead(id).then(function () { load(); window.UI.refreshNotifCount(); }).catch(function () { alert("Failed to mark read"); }); }); })(n.id); right.appendChild(time); right.appendChild(btn); node.appendChild(left); node.appendChild(right); list.appendChild(node); } }
    function load() { window.Notifications.fetchNotifications().then(function (items) { renderNotifications(items || []); }).catch(function () { document.getElementById("notifications-list").innerHTML = '<p class="text-red-500">Failed to load notifications.</p>'; }); }
    document.getElementById("mark-all").addEventListener("click", function () { window.Notifications.markAllRead().then(function () { load(); window.UI.refreshNotifCount(); }).catch(function () { alert("Failed"); }); });
    window.Notifications.startPolling(function (items) { renderNotifications(items || []); window.UI.refreshNotifCount(); });
    load();
  </script>
</body>
</html>
